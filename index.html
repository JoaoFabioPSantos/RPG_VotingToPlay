<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Tela de Acesso</title>

<style>
    body {
        margin: 0;
        padding: 0;
        background: #0f0f0f;
        font-family: "Courier New", monospace;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #ffffff;
    }

    /* Tela de Login */
    #loginBox {
        border: 2px solid #ffffff;
        padding: 20px 30px;
        background: #000;
        box-shadow: none;
        text-align: center;
        color: #ffffff;
    }

    #senha {
        width: 250px;
        padding: 10px;
        background: #000;
        border: 1px solid #ffffff;
        color: #ffffff;
        font-size: 18px;
    }

    #painel {
        display: none;
        height: 100vh;
        width: 100vw;
        background: #000;
        overflow: hidden;
    }

    /* Container das Abas */
    .abas {
        display: flex;
        height: 100%;
        width: 100%;
    }

    .aba {
        position: relative;
        flex: 1;
        overflow: hidden;
        cursor: pointer;
        transition: flex 0.4s ease-in-out;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .aba img {
        position: absolute;
        width: 120%;
        height: 120%;
        object-fit: cover;
        filter: brightness(0.75) contrast(1.1) saturate(0.9);
        transition: 0.4s ease;
    }

    .aba h2 {
        position: relative;
        transform: rotate(-78deg);
        font-size: 1.5rem;
        padding: 10px 20px;
        background: #0009;
        border: 1px solid #fff;
        color: #fff;
    }

    .aba:hover h2{
        transform: rotate(-5deg);
    }

    .descricao {
        position: absolute;
        bottom: -100%;
        width: 100%;
        background: #000c;
        color: #fff;
        padding: 20px;
        text-align: center;
        font-size: 1.2rem;
        transition: 0.5s ease;
    }

    .aba:hover {
        flex: 3;
    }

    .aba:hover img {
        transform: scale(1.07);
        filter: brightness(1) contrast(1.25) saturate(1);
        animation: tv-static 0.3s steps(3) infinite;
    }

    .aba:hover .descricao {
        bottom: 0;
    }

    .header-info {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%) translateY(-20px) scale(0.9);
        background: rgba(0, 0, 0, 0.5);
        padding: 10px 20px;
        border: 1px solid #ffffff55;
        border-radius: 8px;
        color: #ffffff;
        font-size: 1rem;
        text-align: center;
        letter-spacing: 1px;
        opacity: 0;
        pointer-events: none;
        transition: 0.35s ease;
        backdrop-filter: blur(4px);
    }

    .aba:hover .header-info {
        opacity: 1;
        transform: translateX(-50%) translateY(0) scale(1);
    }

/* Adicione este código ao seu bloco <style> existente */

/* Estilo para a Tela de Loading (overlay) */
#loadingOverlay {
    position: fixed; /* Fixa na tela, não rola */
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    /* Fundo semi-transparente para escurecer a página */
    background: rgba(0, 0, 0, 0.9);
    color: #ffffff;
    /* Centraliza o conteúdo (texto e spinner) */
    display: none; 
    align-items: center;
    justify-content: center;
    flex-direction: column;
    z-index: 9999; /* Garante que fique acima de todos os outros elementos */
    font-size: 1.5rem;
    font-weight: bold;
    backdrop-filter: blur(2px); /* Efeito de desfoque opcional */
}

/* Estilo para o ícone de carregamento (spinner) */
.spinner {
    border: 4px solid rgba(255, 255, 255, 0.3);
    border-top: 4px solid #ffffff; /* Cor de destaque no topo */
    border-radius: 50%;
    width: 35px;
    height: 35px;
    animation: spin 0.8s linear infinite; /* Aplica a animação */
    margin-top: 20px;
}

/* Define a animação de rotação */
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>
</head>

<body>

<!-- Tela de Login -->
<div id="loginBox">
    <h1>Caixa Fechada</h1>
    <input type="password" id="senha" placeholder="Digite a senha..." />
</div>

<!-- Painel com Abas -->
<div id="painel">
    <div class="abas">

        <div class="aba">
            <img src="img1.jpg" alt="Imagem 1">
            <h2>Vaesen</h2>
            <div class="header-info">
                • <span>Tipo: Aventura Longa</span><br/>
                • <span>Vibe: Sombria</span><br/>
                • <span>Sistema: D&D 5e</span>
            </div>
            <div class="descricao">Descrição da primeira aba.</div>
        </div>

        <div class="aba">
            <img src="img2.jpg" alt="Imagem 2">
            <h2>Cervejada Caótica</h2>
            <div class="header-info">
               • <span>Tipo: Aventura Linear </span><br/> • <span>Vibe:"Taverna camping", exploração</span><br/> • <span>Sistema: Altaris RPG</span><br/> • <span>Duração: 6 a 8 horas</span>
            </div>
            <div class="descricao">Descrição da segunda aba.</div>
        </div>

        <div class="aba">
            <img src="assets/images/WilderFeast.webp" alt="Imagem 3">
            <h2>O culinarístico mundo selvagem</h2>
            <div class="header-info">
                <span>Tipo: Exploração</span> • <span>Vibe: Épica</span> • <span>Sistema: Pathfinder</span>
            </div>
            <div class="descricao">Um mundo selvagem requer muita selvageria, neste caso, que tal comer um lendário dragão glutoso da lendária dungeon de Alcassuz?</div>
        </div>

        <div class="aba">
            <img src="assets/images/WilderFeast.webp" alt="Imagem 3">
            <h2>O último dia do ano</h2>
            <div class="header-info">
                <span>Tipo: Exploração</span> • <span>Vibe: Épica</span> • <span>Sistema: Pathfinder</span>
            </div>
            <div class="descricao">Um mundo selvagem requer muita selvageria, neste caso, que tal comer um lendário dragão glutoso da lendária dungeon de Alcassuz?</div>
        </div>

        <div class="aba">
            <img src="assets/images/WilderFeast.webp" alt="Imagem 3">
            <h2>Goblinoides</h2>
            <div class="header-info">
                <span>Tipo: Exploração</span> • <span>Vibe: Épica</span> • <span>Sistema: Pathfinder</span>
            </div>
            <div class="descricao">Um mundo selvagem requer muita selvageria, neste caso, que tal comer um lendário dragão glutoso da lendária dungeon de Alcassuz?</div>
        </div>

        <div class="aba">
            <img src="assets/images/WilderFeast.webp" alt="Imagem 3">
            <h2>Valeu Natalina ~ </h2>
            <div class="header-info">
                <span>Tipo: Exploração</span> • <span>Vibe: Épica</span> • <span>Sistema: Pathfinder</span>
            </div>
            <div class="descricao">Um mundo selvagem requer muita selvageria, neste caso, que tal comer um lendário dragão glutoso da lendária dungeon de Alcassuz?</div>
        </div>

        <div class="aba">
            <img src="assets/images/WilderFeast.webp" alt="Imagem 3">
            <h2>Esqueletecos</h2>
            <div class="header-info">
                <span>Tipo: Exploração</span> • <span>Vibe: Épica</span> • <span>Sistema: Pathfinder</span>
            </div>
            <div class="descricao">Um mundo selvagem requer muita selvageria, neste caso, que tal comer um lendário dragão glutoso da lendária dungeon de Alcassuz?</div>
        </div>
    </div>
</div>
<div id="loadingOverlay">
    <p>Registrando Seleção...</p>
    <div class="spinner"></div>
</div>

<script>
    const senhaInput = document.getElementById("senha");
    const loginBox = document.getElementById("loginBox");
    const painel = document.getElementById("painel");
    const loadingOverlay = document.getElementById("loadingOverlay"); 

    // *** MUITO IMPORTANTE: SUBSTITUA PELA URL DO SEU APPS SCRIPT WEB APP ***
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxfJa4w8scQU0yLr1LGOStr6W49bSXDvpiOu3JI9on8n705kgHlwMAuzvDyFSkieMC5/exec"; 

    /**
     * Envia o título da aba clicada (AGORA COM type: vote)
     */
    async function registrarSelecao(titulo) {
        loadingOverlay.style.display = 'flex'; 

        const dados = {
            tipo: "vote", // NOVO: Identifica como requisição de voto
            titulo: titulo,
            data: new Date().toLocaleString('pt-BR') 
        };

        try {
            const response = await fetch(WEB_APP_URL, {
                method: 'POST',
                mode: 'no-cors', 
                body: JSON.stringify(dados)
            });
            
            console.log(`Voto "${titulo}" enviado.`);
            alert(`Você selecionou: ${titulo}. Voto computado!`);

        } catch (error) {
            console.error('Erro ao registrar o voto:', error);
            alert(`Erro ao registrar o voto (${titulo}).`);
        } finally {
            loadingOverlay.style.display = 'none'; 
        }
    }

    /**
     * Verifica a senha digitada no Apps Script (type: login)
     */
    async function verificarLogin(senha) {
        loadingOverlay.style.display = 'flex'; 

        const dados = {
            tipo: "login", // NOVO: Identifica como requisição de login
            senha: senha
        };

        try {
            const response = await fetch(WEB_APP_URL, {
                method: 'POST',
                // Removendo 'no-cors' para tentar ler a resposta do GAS
                // Isso pode exigir ajustes na implantação do GAS para permitir CORS.
                // Mas vamos tentar manter a simplicidade do GAS aqui.
                mode: 'cors', // Necessário para ler o JSON de resposta
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(dados)
            });

            // O Google Apps Script retorna a resposta JSON
            const resultado = await response.json();
            
            return resultado.login === true; // Retorna true ou false
        
        } catch (error) {
            console.error('Erro ao verificar login (API/Rede):', error);
            // Em caso de erro de rede/API, tratamos como falha de login por segurança
            return false;
        } finally {
            loadingOverlay.style.display = 'none';
        }
    }


    // Listener para o evento de login
    senhaInput.addEventListener("keydown", async function(e) {
        if (e.key === "Enter") {
            const senhaDigitada = senhaInput.value;
            // 1. CHAMA O NOVO VERIFICADOR ASSÍNCRONO
            const loginSucesso = await verificarLogin(senhaDigitada); 

            if (loginSucesso) {
                loginBox.style.display = "none";
                painel.style.display = "block";
                
                // Adiciona Listener de Clique às Abas SÓ APÓS O LOGIN
                const abas = document.querySelectorAll('.aba');
                abas.forEach(aba => {
                    aba.addEventListener('click', () => {
                        const tituloElement = aba.querySelector('h2');
                        if (tituloElement) {
                            const titulo = tituloElement.textContent.trim();
                            registrarSelecao(titulo);
                        }
                    });
                });
            } else {
                senhaInput.style.borderColor = "red";
                senhaInput.value = "";
                alert("Senha Incorreta!");
            }
        }
    });
</script>

</body>
</html>
